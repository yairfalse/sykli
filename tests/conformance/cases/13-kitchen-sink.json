{"version":"1","tasks":[{"name":"lint","command":"golangci-lint run","inputs":["**/*.go"],"timeout":60,"semantic":{"criticality":"low"},"ai_hooks":{"on_fail":"skip"}},{"name":"test","command":"go test ./...","env":{"CGO_ENABLED":"0"},"inputs":["**/*.go","go.mod"],"depends_on":["lint"],"secrets":["CODECOV_TOKEN"],"matrix":{"go_version":["1.21","1.22"]},"services":[{"image":"postgres:15","name":"db"}],"retry":2,"timeout":300,"semantic":{"covers":["src/**/*.go"],"intent":"unit tests for all packages","criticality":"high"},"ai_hooks":{"on_fail":"analyze","select":"smart"}},{"name":"build","command":"go build -o /out/app","outputs":{"binary":"/out/app"},"depends_on":["test"],"target":"docker","k8s":{"memory":"4Gi","cpu":"2"},"requires":["docker"],"provides":[{"name":"binary","value":"/out/app"}]},{"name":"approve-deploy","depends_on":["build"],"gate":{"strategy":"env","timeout":1800,"message":"Deploy to production?","env_var":"DEPLOY_APPROVED"}},{"name":"deploy","command":"kubectl apply -f k8s/","depends_on":["approve-deploy"],"when":"branch:main","secret_refs":[{"name":"kube_config","source":"file","key":"/home/.kube/config"},{"name":"registry_pass","source":"vault","key":"secret/data/registry#password"}],"needs":["binary"]}]}
